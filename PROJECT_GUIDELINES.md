# é¡¹ç›®å¼€å‘è§„èŒƒä¸æ¶æ„æŒ‡å—

æœ¬é¡¹ç›®é‡‡ç”¨ **Feature-First (åŠŸèƒ½ä¼˜å…ˆ)** çš„æ¶æ„æ¨¡å¼ï¼Œæ—¨åœ¨ç¡®ä¿ä»£ç åœ¨ä¸šåŠ¡å¢é•¿æ—¶ä¿æŒé«˜å†…èšã€ä½è€¦åˆã€‚

## 1. ç›®å½•ç»“æ„è§„èŒƒ

### `src/app` (è·¯ç”±å±‚)
- **èŒè´£**: å®šä¹‰è·¯ç”±ã€å¸ƒå±€ (Layout)ã€å…ƒæ•°æ® (Metadata) å’ŒæœåŠ¡ç«¯æ•°æ®è·å–ã€‚
- **è§„èŒƒ**: é¡µé¢ç»„ä»¶åº”ä¿æŒâ€œè–„â€ï¼Œä¸»è¦è´Ÿè´£ç»„åˆ `features` ä¸­çš„ä¸šåŠ¡ç»„ä»¶ã€‚é¿å…åœ¨é¡µé¢æ–‡ä»¶ä¸­ç›´æ¥å®šä¹‰å¤æ‚çš„è¡¨å•æˆ–ä¸šåŠ¡é€»è¾‘ã€‚

### `src/features` (ä¸šåŠ¡åŠŸèƒ½å±‚)
- **èŒè´£**: åŒ…å«ç‰¹å®šä¸šåŠ¡é¢†åŸŸçš„æ‰€æœ‰é€»è¾‘ã€‚
- **å†…éƒ¨ç»“æ„**:
  - `actions/`: Server Actionsï¼Œè´Ÿè´£å¤„ç†è¡¨å•æäº¤å’Œä¸šåŠ¡é€»è¾‘ã€‚
  - `components/`: è¯¥åŠŸèƒ½ç‰¹æœ‰çš„ UI ç»„ä»¶ã€‚
  - `hooks/`: (å¯é€‰) è¯¥åŠŸèƒ½ç‰¹æœ‰çš„ React Hooksã€‚
  - `schemas.ts`: Zod æ ¡éªŒæ¨¡å¼ã€‚
  - `types.ts`: TypeScript ç±»å‹å®šä¹‰ã€‚
  - `index.ts`: å…¬å…± API å¯¼å‡ºæ–‡ä»¶ã€‚**å¤–éƒ¨æ¨¡å—åªèƒ½é€šè¿‡ index.ts å¯¼å…¥è¯¥ feature çš„å†…å®¹ã€‚**

### `src/components` (é€šç”¨ç»„ä»¶å±‚)
- `ui/`: åŸºç¡€åŸå­ç»„ä»¶ (å¦‚ Button, Input)ï¼Œé€šå¸¸ç”± shadcn/ui ç”Ÿæˆã€‚
- `shared/`: è·¨ä¸šåŠ¡åŠŸèƒ½çš„é€šç”¨ç»„ä»¶ (å¦‚ Navbar, Footer, ThemeToggle)ã€‚

### `src/lib` (åŸºç¡€è®¾æ–½å±‚)
- `db/`: æ•°æ®åº“é…ç½®ã€Schema å®šä¹‰ã€‚
- `db/dao/`: Data Access Objectsï¼Œå°è£…åº•å±‚çš„æ•°æ®åº“ CRUD æ“ä½œã€‚
- `services/`: å¤æ‚çš„è·¨æ¨¡å—ä¸šåŠ¡é€»è¾‘ã€‚
- `utils.ts`: é€šç”¨å·¥å…·å‡½æ•°ã€‚

## 2. å¼€å‘åŸåˆ™

1.  **å•å‘ä¾èµ–**: `features` ä¹‹é—´åº”å°½é‡å‡å°‘ç›´æ¥ä¾èµ–ã€‚å¦‚æœå¤šä¸ª feature éœ€è¦å…±äº«é€»è¾‘ï¼Œè€ƒè™‘å°†å…¶æå–åˆ° `lib` æˆ– `components/shared`ã€‚
2.  **DAO å°è£…**: ä¸è¦ç›´æ¥åœ¨ Server Actions ä¸­è°ƒç”¨ Drizzle çš„ `db.select()` ç­‰æ–¹æ³•ï¼Œåº”é€šè¿‡ `lib/db/dao` è¿›è¡Œå°è£…ï¼Œä¾¿äºæµ‹è¯•å’Œå¤ç”¨ã€‚
3.  **Server Actions**: æ‰€æœ‰çš„è¡¨å•æäº¤å’ŒçŠ¶æ€å˜æ›´åº”ä½¿ç”¨ Server Actionsã€‚
4.  **ç±»å‹å®‰å…¨**: å……åˆ†åˆ©ç”¨ TypeScript å’Œ Zodï¼Œç¡®ä¿ä»æ•°æ®åº“åˆ° UI çš„å…¨é“¾è·¯ç±»å‹å®‰å…¨ã€‚
5.  **å¯¼å‡ºè§„èŒƒ**: å§‹ç»ˆä½¿ç”¨ `index.ts` å¯¼å‡º feature çš„å…¬å…±æ¥å£ï¼Œé¿å…æ·±å±‚å¯¼å…¥ï¼ˆå¦‚ `import { ... } from "@/features/auth/actions/login"`ï¼‰ã€‚

## 3. å‘½åçº¦å®š

-   **ç»„ä»¶**: å¤§é©¼å³° (PascalCase)ï¼Œå¦‚ `LoginForm.tsx`ã€‚
-   **æ–‡ä»¶/æ–‡ä»¶å¤¹**: å°å†™æ¨ªæ  (kebab-case)ï¼Œå¦‚ `update-profile.ts`ã€‚
-   **Actions**: ä»¥ `Action` ç»“å°¾ï¼Œå¦‚ `loginAction`ã€‚
-   **DAO**: ä»¥ `dao` ç»“å°¾ï¼Œå¦‚ `usersDao`ã€‚

## 4. å­—ä½“ä¸æ’ç‰ˆè§„èŒƒ

### 4.1 å­—ä½“æ—é…ç½® (Font Family)

é‡‡ç”¨åˆ†å±‚å›é€€æœºåˆ¶ï¼Œä¼˜å…ˆä½¿ç”¨ç³»ç»ŸåŸç”Ÿå­—ä½“ï¼Œé¿å…å¤–éƒ¨å­—ä½“åŠ è½½å¸¦æ¥çš„æ€§èƒ½é—®é¢˜ã€‚

**æ— è¡¬çº¿å­—ä½“ (Sans-serif) - ç”¨äºæ ‡é¢˜ã€æ­£æ–‡ã€UI å…ƒç´ **
- **iOS/macOS**: San Francisco, PingFang SC
- **Windows**: Segoe UI, Microsoft YaHei  
- **Android**: Roboto, Noto Sans CJK SC
- **å›é€€é“¾**: `-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", "Simplified Chinese", sans-serif`

**ç­‰å®½å­—ä½“ (Monospace) - ç”¨äºä»£ç ã€è¡¨å•æ•°æ®ã€æ•°å€¼**
- å›é€€é“¾: `ui-monospace, SFMono-Regular, "SF Mono", Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace`

### 4.2 å­—ä½“æ¸²æŸ“ä¼˜åŒ– (Rendering)

åœ¨ `body` æ ‡ç­¾ä¸­åº”ç”¨ä»¥ä¸‹ CSS ä¼˜åŒ–ï¼Œä¿®å¤ä¸åŒæµè§ˆå™¨ä¸‹çš„å­—ä½“ç²—ç»†ä¸å‡å’Œé”¯é½¿é—®é¢˜ï¼š

```css
body {
  -webkit-font-smoothing: antialiased;  /* Mac ç³»ç»Ÿå¹³æ»‘ */
  -moz-osx-font-smoothing: grayscale;   /* Firefox å¹³æ»‘ */
  text-rendering: optimizeLegibility;   /* æ–‡æœ¬å¾®è°ƒ */
  -webkit-text-size-adjust: 100%;       /* ç¦ç”¨ç§»åŠ¨ç«¯è‡ªåŠ¨æ”¾å¤§ */
}
```

### 4.3 å­—é˜¶ä¸è¡Œé«˜è§„èŒƒ (Typography Scale)

é‡‡ç”¨ 4px ä¸ºåŸºæ•°çš„å€æ•°å…³ç³»ï¼Œç¡®ä¿è§†è§‰èŠ‚å¥ä¸¥è°¨ã€‚æ‰€æœ‰æ ·å¼é€šè¿‡ Tailwind CSS å·¥å…·ç±»åº”ç”¨ã€‚

| ç­‰çº§ | å­—å· | è¡Œé«˜ | æƒé‡ | Tailwind ç±» | ä½¿ç”¨åœºæ™¯ |
|-----|------|------|------|------------|----------|
| **ä¸€çº§æ ‡é¢˜** | 32px | 1.2 | 600 | `text-3xl font-semibold leading-tight` | é¡µé¢ä¸»æ ‡é¢˜ |
| **äºŒçº§æ ‡é¢˜** | 24px | 1.3 | 600 | `text-2xl font-semibold leading-snug` | æ¨¡å—æ ‡é¢˜ |
| **ä¸‰çº§æ ‡é¢˜** | 20px | 1.4 | 600 | `text-xl font-semibold` | å°ç»„æ ‡é¢˜ |
| **å¼ºè°ƒæ­£æ–‡** | 16px | 1.5 | 500 | `text-base font-medium leading-relaxed` | å¡ç‰‡å†…å®¹ |
| **æ ‡å‡†æ­£æ–‡** | 14px | 1.5 | 400 | `text-sm leading-relaxed` | é»˜è®¤æ–‡æœ¬ |
| **è¾…åŠ©æ–‡å­—** | 12px | 1.4 | 400 | `text-xs leading-normal` | è¡¨å•æç¤ºã€é¡µè„š |

**é‡è¦ ğŸ”´**: ä¸­æ–‡ç¯å¢ƒå»ºè®®ä½¿ç”¨ `font-semibold (600)` è€Œé `font-bold (700)`ï¼Œä»¥é˜²æ–‡å­—å‘è™šã€‚

### 4.4 é¢œè‰²ä¸å¯¹æ¯”åº¦ (Color & Contrast)

ä¸¥ç¦ä½¿ç”¨çº¯é»‘è‰²ï¼Œé‡‡ç”¨ç°åº¦æ¢¯é˜Ÿä»¥å‡è½»è§†è§‰ç–²åŠ³ï¼š

- **ä¸€çº§æ–‡æœ¬** (æ ‡é¢˜/æ­£æ–‡): `text-foreground` - `rgba(0, 0, 0, 0.88)` (äº®è‰²) / `rgba(255, 255, 255, 0.92)` (æš—è‰²)
- **äºŒçº§æ–‡æœ¬** (æ¬¡è¦ä¿¡æ¯): `text-muted-foreground` - `rgba(0, 0, 0, 0.65)` (äº®è‰²) / `rgba(255, 255, 255, 0.65)` (æš—è‰²)  
- **ä¸‰çº§æ–‡æœ¬** (ç¦ç”¨/å ä½ç¬¦): `text-muted` - æ›´æ·¡çš„ç°åº¦

### 4.5 æ€§èƒ½ä¸åŠ è½½ (Performance)

- âœ… ä¼˜å…ˆä½¿ç”¨ç³»ç»Ÿå­—ä½“ï¼Œé¿å…å¤–éƒ¨ WebFont åŠ è½½å»¶è¿Ÿ
- âœ… è‹¥å¿…é¡»ä½¿ç”¨è‡ªå®šä¹‰å­—ä½“ï¼Œä»…å…è®¸ `.woff2` æ ¼å¼
- âœ… æ·»åŠ  `font-display: swap;` é¿å… FOIT (æ–‡å­—é—ªçƒ)
- âœ… ä¸­æ–‡å­—ä½“å¿…é¡»å­é›†åŒ–ï¼Œä½“ç§¯ â‰¤ 200KB
- âœ… æ¨èä½¿ç”¨ Google Fonts æˆ– Alibaba å…è´¹æ–¹æ¡ˆ

### 4.6 å®æ–½æ£€æŸ¥æ¸…å• (Checklist)

- [ ] æ˜¯å¦åœ¨ Mac ä¸ Windows ä¸‹æ£€æŸ¥è¿‡å­—ä½“ç²—ç»†ï¼Ÿ
- [ ] è¡Œé«˜æ˜¯å¦ä¸¥æ ¼æŒ‰è¡¨æ ¼æ‰§è¡Œï¼Ÿ  
- [ ] æ‰€æœ‰æ•°å€¼/ä»£ç æ˜¯å¦ä½¿ç”¨ `font-mono`ï¼Ÿ
- [ ] é“¾æ¥/æŒ‰é’®ç‚¹å‡»æ€æ˜¯å¦ä¿æŒå­—ä½“é¢œè‰²ä¸€è‡´æ€§ï¼Ÿ
- [ ] ç§»åŠ¨ç«¯æ˜¯å¦æµ‹è¯•è¿‡å­—ä½“ç¼©æ”¾ï¼Ÿ

## 5. H5 å…¼å®¹æ€§ä¸ç§»åŠ¨ç«¯è§„èŒƒ

### 5.1 è§†å£é…ç½® (Viewport)

æ‰€æœ‰é¡µé¢å¿…é¡»åœ¨ `<head>` ä¸­åŒ…å«æ­£ç¡®çš„è§†å£é…ç½®ï¼Œé€šè¿‡ Next.js `metadata` API è®¾ç½®ã€‚

```typescript
export const metadata: Metadata = {
  viewport: {
    width: "device-width",
    initialScale: 1,
    viewportFit: "cover",
    userScalable: false,
  },
  appleWebApp: {
    capable: true,
    statusBarStyle: "black-translucent",
  },
};
```

### 5.2 è§¦æ‘¸ä¸äº¤äº’è§„èŒƒ (Touch & Interaction)

| è§„åˆ™ | æ ‡å‡† | å®ç°æ–¹æ¡ˆ |
|-----|------|--------|
| **æŒ‰é’®æœ€å°ç‚¹å‡»åŒºåŸŸ** | 44Ã—44px | ä½¿ç”¨ `touch-target` æˆ– `h-11 w-11` æˆ–æ›´å¤§ |
| **æŒ‰é’®é—´è·** | â‰¥8px | ä½¿ç”¨ `gap-2` æˆ– `gap-3` |
| **é•¿æŒ‰åé¦ˆ** | éœ€è¦è§†è§‰åé¦ˆ | ä½¿ç”¨ `active:scale-[0.98]` |
| **åŒå‡»ç¼©æ”¾ç¦ç”¨** | `user-scalable=no` | å·²åœ¨ viewport é…ç½®ä¸­ |
| **é“¾æ¥ç‚¹å‡»åŒºåŸŸæ‰©å±•** | å‘¨å›´ 8px | ä½¿ç”¨ `px-3 py-2.5` æˆ– `touch-target` |
| **ç¦ç”¨é•¿æŒ‰èœå•** | ç§»é™¤åŸç”Ÿèœå• | ä½¿ç”¨ `-webkit-touch-callout: none` |

### 5.3 å­—ä½“ä¸è¾“å…¥æ¡†ä¼˜åŒ– (Mobile Typography)

**å…³é”®åŸåˆ™**:
- æ‰€æœ‰è¾“å…¥æ¡†åŸºç¡€å­—å· â‰¥ 16pxï¼Œé˜²æ­¢ iOS Safari è‡ªåŠ¨æ”¾å¤§
- ç¦ç”¨è¾“å…¥æ¡†çš„åŸç”Ÿæ ·å¼ (`-webkit-appearance: none`)
- ç§»é™¤ iOS tap highlight

```css
/* è¾“å…¥æ¡†é˜²æ­¢è‡ªåŠ¨æ”¾å¤§ */
input, textarea, select {
  font-size: 16px; /* >= 16px */
  -webkit-appearance: none;
  -moz-appearance: none;
  appearance: none;
}

/* ç§»åŠ¨ç«¯å“åº”å¼å­—å· */
@media (max-width: 640px) {
  h1 { @apply text-2xl; }    /* 32px â†’ 24px */
  h2 { @apply text-xl; }     /* 24px â†’ 20px */
  h3 { @apply text-lg; }     /* 20px â†’ 18px */
}
```

### 5.4 å®‰å…¨åŒºåŸŸé€‚é… (iOS Notch & Home Indicator)

ä½¿ç”¨ CSS ç¯å¢ƒå˜é‡é€‚é… iOS åˆ˜æµ·å±å’Œ Home Indicatorï¼š

```css
.safe-top { @apply pt-[env(safe-area-inset-top)]; }
.safe-bottom { @apply pb-[env(safe-area-inset-bottom)]; }
.safe-left { @apply pl-[env(safe-area-inset-left)]; }
.safe-right { @apply pr-[env(safe-area-inset-right)]; }
```

åº”ç”¨æ–¹å¼ï¼š
- å¯¼èˆªæ é¡¶éƒ¨: `<header className="safe-top">...</header>`
- åº•éƒ¨å¯¼èˆª: `<footer className="safe-bottom">...</footer>`

### 5.5 æ€§èƒ½ä¼˜åŒ– (Mobile Performance)

- âœ… **å›¾ç‰‡**: ä½¿ç”¨ Next.js `<Image />` ç»„ä»¶ï¼Œå¯ç”¨ `priority` å’Œ `placeholder`
- âœ… **CSS**: Tailwind JIT ç¼–è¯‘ï¼Œäº§ç”Ÿæœ€å° CSS ä½“ç§¯
- âœ… **é‡æ’**: é¿å…åŠ¨æ€é«˜åº¦å˜åŒ–ï¼Œä½¿ç”¨å›ºå®šå°ºå¯¸
- âœ… **æ‡’åŠ è½½**: ä½¿ç”¨ `loading="lazy"` å»¶è¿ŸåŠ è½½å›¾ç‰‡
- âœ… **é˜²æŠ–èŠ‚æµ**: è¡¨å•æäº¤ã€æ»šåŠ¨äº‹ä»¶ä½¿ç”¨é˜²æŠ–/èŠ‚æµ

### 5.6 å“åº”å¼è®¾è®¡æ–­ç‚¹ (Responsive Breakpoints)

| è®¾å¤‡ | Tailwind å‰ç¼€ | CSS èŒƒå›´ | åº”ç”¨åœºæ™¯ |
|-----|-------------|---------|--------|
| **æ‰‹æœºç«–å±** | None | < 640px | å•åˆ—å¸ƒå±€ï¼Œå †å ç»„ä»¶ |
| **æ‰‹æœºæ¨ªå±** | `sm` | â‰¥ 640px | ä¸¤åˆ—å¸ƒå±€ï¼Œç´§å‡‘é—´è· |
| **å¹³æ¿** | `md` | â‰¥ 768px | ä¸‰åˆ—å¸ƒå±€ï¼Œæ­£å¸¸é—´è· |
| **æ¡Œé¢** | `lg`/`xl` | â‰¥ 1024px | å¤šåˆ—å¸ƒå±€ï¼Œå¤§é—´è· |

### 5.7 H5 æ£€æŸ¥æ¸…å• (Checklist)

- [ ] æ‰€æœ‰æŒ‰é’®/é“¾æ¥ â‰¥ 44Ã—44pxï¼Œæˆ–æœ‰å……åˆ†çš„ padding
- [ ] è¾“å…¥æ¡†å­—å· â‰¥ 16pxï¼ˆé˜²æ­¢ iOS è‡ªåŠ¨æ”¾å¤§ï¼‰
- [ ] å†…å®¹å®½åº¦ä½¿ç”¨ `max-w-5xl` é™åˆ¶ï¼Œé˜²æ­¢è¿‡åº¦æ‹‰ä¼¸
- [ ] é¡¶éƒ¨å¯¼èˆªæ é¢„ç•™å®‰å…¨åŒºï¼ˆ`safe-top`ï¼‰
- [ ] åº•éƒ¨æ“ä½œæ é¢„ç•™å®‰å…¨åŒºï¼ˆ`safe-bottom`ï¼‰
- [ ] è¡¨å•æœ‰æ˜æ˜¾çš„ `:focus` å’Œ `:active` åé¦ˆ
- [ ] å›¾ç‰‡ä½¿ç”¨ Next.js `<Image />` å¹¶å¯ç”¨å“åº”å¼
- [ ] è§¦æ‘¸ç›®æ ‡é—´è· â‰¥ 8px
- [ ] åœ¨çœŸæœºä¸Šæµ‹è¯•ç«–å±å’Œæ¨ªå±æ¨¡å¼
- [ ] åœ¨ 2G/3G ç½‘ç»œä¸‹æµ‹è¯•åŠ è½½é€Ÿåº¦

